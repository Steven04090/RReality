
    <div id="chart-box-layout">
      <div class="infographic_graphic_section p-1">
        <div id="controler" class="controler mb-2">
        </div>
        <div class="chart-container">
          <canvas id="canvas"></canvas>
        </div>
      </div>
    </div>
<script>

</script>
<script>
  var chart;
  var sites = [];
  var data = {datasets: sites};
  const ctx = document.getElementById('canvas').getContext('2d');

  Chart.register({
        id:'vertical_line_and_x_axis_text',
        afterDraw: chart => {
          //x axis
          const{ ctx, chartArea:{top,bottom,right},scales:{x,y}}= chart;
          ctx.save();
          ctx.font ='12px Arial';
          ctx.fillStyle = '#f1f1f1';
          ctx.fillText('(Zeny)',0, top -10);
          ctx.restore();

            //hover draw vertical line
            if (chart.tooltip?._active?.length) {               
               let x = chart.tooltip._active[0].element.x;             
               let yAxis = chart.scales.y;
               let ctx = chart.ctx;
               ctx.save();
               ctx.beginPath();
               ctx.moveTo(x, yAxis.top);
               ctx.lineTo(x, yAxis.bottom);
               ctx.lineWidth = 1;
               ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
               ctx.stroke();
               ctx.restore();
            }
          },


      });

  //json轉檔
  JsonTransition();
  function JsonTransition(){
  $.getJSON("Assets/json/game_price.json", function(json_file) {
   //json to array
   x_array = json_file.Blacksmith_Blessing.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });
   y_array = json_file.Hyperspace_Gem_Rough_Stone.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });

   z_array = json_file.Old_Card_Album.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });
   a_array = json_file.honor_rose.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });
   b_array = json_file.mystery_spell_book.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });
   c_array = json_file.Enriched_Elunium_Box.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });
   d_array = json_file.ether_stardust.map(function(item) {
      return {
        'x':item.date,
        'y':item.sell_price
      };
   });
   //load data
   load_data();
    // draw chart
    init();
  });
};

  const zoomOptions = {
    limits:{
        y:{min:'original',max:'original'},
        x:{min:'original', max: 'original',minRange:3600*1000*24 },//time base on 1000
      },
      pan: {
        enabled: true,
        mode: 'xy',
      },
      zoom:{
        mode: 'xy',
        wheel: {
          enabled: true,
        },
        pinch: {
          enabled: true,
        },
        //zoom 改變x軸顯示
        onZoomComplete({chart}) {

        chart.update('none');
       }
      },
    }
  const options ={
        maintainAspectRatio:false,
        responsive: true,
        interaction: {
          intersect: false,
          axis:'x',
          mode: 'nearest',
        },
         plugins:{  
            zoom: zoomOptions,
            title:{
              display:false,
              color:'#fff',
              position:"bottom",
              font:{size:20,},
            },
            legend: {
            display: true,
              labels:{
                color:'#eee',
              }
            }, 
          },
         
          scales: { 
            y:{
                grid: {color: 'rgba( 160, 255, 240, 0.2)',},
                border:{color:"rgba( 160, 255, 240, 0.25)",width:1,},
                display:true,
                min:0,
                ticks: {
                    color:"#eee",
                    beginAtZero: true,
                    precision:0,
                    padding: 8,
                    crossAlign: 'start',
                    callback: (value, index, ticks) => {
                      if(index === ticks.length - 1){return null;}
                      else
                          if(value >= 10000){return Math.floor(value/10000) + 'W';}

                    }
                }
            },
            x: { 
              ticks: {
                    color:"#eee",
                },
              grid: {
                color: 'rgba( 160, 255, 240, 0.2)',
                },
                type: 'time',
                  time: {
                    tooltipFormat: 'YYYY/MM/DD',
                    unit:  'day',
                },
                border:{display:false,},
                display: true,
            },      
          },
        };
  
  const config = {
      type: 'line',
      data: data,
      options:options,
      };
  function init() {
  chart = new Chart(ctx, config);
    };
</script>
<script>
  function load_data(){
            var site = {
                label:'鐵匠的祝福',
                data:x_array,
                tension: 1,
                pointRadius:5,
            };
            var site2 = {
                label:'超時空寶石原石',
                data:y_array,
                tension: 1,
                pointRadius:5,
            };
            var site3 = {
                label:'老舊收集冊',
                data:z_array,
                tension: 1,
                pointRadius:5,
            };
            var site4 = {
                label:'榮譽玫瑰',
                data:a_array,
                tension: 1,
                pointRadius:5,
            };
            var site5 = {
                label:'神秘咒語集',
                data:b_array,
                tension: 1,
                pointRadius:5,
            };
            var site6 = {
                label:'濃縮鋁箱子',
                data:c_array,
                tension: 1,
                pointRadius:5,
            };
            var site7 = {
                label:'乙太星塵',
                data:d_array,
                tension: 1,
                pointRadius:5,
            };
          sites.push(site);
          sites.push(site2);
          sites.push(site3);
          sites.push(site4);
          sites.push(site5);
          sites.push(site6);
          sites.push(site7);
    };
</script>
<script>
  //zoom區
  function resetZoom() {
  chart.resetZoom();
}

</script>
</html>