
  
  <div class="d-flex">
      <div class="d-flex flex-column text-center" style="min-width:150px;color:#f1f1f1;">
                  <div class="w-100 d-flex flex-column justify-content-center p-1">
                    <div class="d-flex flex-column align-items-center justify-content-center" style="height: 150px;background-color:rgba(63, 89, 102, 0.21);">
                        <span id="normal" style="font-size:2em;">0</span>
                        <span>正常<span style="font-size: 0.8em;">(次)</span></span>
                    </div>
                  </div>
                  <div class="w-100 d-flex flex-column justify-content-center p-1">
                    <div class="d-flex flex-column align-items-center justify-content-center" style="height: 150px;background-color:rgba(63, 89, 102, 0.21);">
                        <span id="temp" style="font-size:2em;">0</span>
                        <span>臨時<span style="font-size: 0.8em;">(次)</span></span>
                    </div>
                </div>
                <div class="w-100 d-flex flex-column justify-content-center p-1">
                    <div class="d-flex flex-column align-items-center justify-content-center" style="height: 150px;background-color:rgba(63, 89, 102, 0.21);">
                        <span id="delay" style="font-size:2em;">0</span>
                        <span>延後<span style="font-size: 0.8em;">(次)</span></span> 
                    </div>
                </div>
      </div>
    <div id="calendar"></div>
  </div>
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.css" />
  <style>
      #calendar{width:100%;color:var(--main-text-color);overflow:unset;background-color: #141c1e69;}
      .tippy-tooltip{background-color:#f1f1f1;}
      .month-container{padding: 10px 4px !important;}
      .calendar .calendar-spinner > div{background-color:#f1f1f1;}
  </style>
  
     <script src="https://unpkg.com/tippy.js@4"></script>
<script>
    var number_array = [];
    let tooltip = null;
    // dataSource json use fetch api
    let dataSource =  function({year}) {
    return fetch('Assets/json/maintain.json')
      .then(result => result.json())
      .then(result => {
        if (result.items) {
          return result.items.map(r => ({
            startDate: new Date(r.date),
            endDate: new Date(r.date),
            name: r.status,
            color:r.color,
            details: r.special
          }));
        }
        return [];  
      });
    }
    const calendar = new Calendar('#calendar', {
    language: 'zh-TW',
    dataSource: dataSource,
    mouseOnDay: function(e) {
    if (e.events.length > 0) {
      var content = '';
      for (var i in e.events) {
          if(e.events[i].details ==undefined){
            e.events[i].details = "";
          }
        content += '<div class="event-tooltip-content">'
          + '<div class="event-name" style="color:' + e.events[i].color + '">' + e.events[i].name + '</div>' + '<div class="event-details" style="color:' + e.events[i].color + '">' + e.events[i].details + '</div>'+ '</div>';
      }
      
      if (tooltip !== null) {
        tooltip.destroy();
        tooltip = null;
      }
      
      tooltip = tippy(e.element, {
          placement: 'right',
          content: content,
          animateFill: false,
          animation: 'shift-away',
          arrow: true
      });
      tooltip.show();
    }
  },
  mouseOutDay: function() {
    if (tooltip !== null) {
      tooltip.destroy();
      tooltip = null;
    }
  }
});

    var today = new Date();
    var thisyear =  today.getFullYear();
    $.getJSON("Assets/json/maintain.json", function(json_file) {
        var n1 = 0;
        var t1 = 0;
        var d1 = 0;
        var z = 0;
        for(var i = 0 ;i < json_file.items.length; i++){
          var inside_array = [];
          //如果資料讀到前一年 或最後一筆 就統計
          if ((new Date(json_file.items[i].date)).getFullYear() != thisyear - z || i == json_file.items.length - 1){
            z++;
            inside_array.push(n1,t1,d1);
            number_array.push(inside_array);
            n1 = 0;
            t1 = 0;
            d1 = 0;
          }
            //如果資料年份 = 今年 然後分類
            if ((new Date(json_file.items[i].date)).getFullYear() == thisyear - z){
                if(json_file.items[i].normal_maintain==1){
                    n1+=1;
                }
                else if(json_file.items[i].temporary_maintain==1){
                    t1+=1;
                }
                else{
                    d1+=1;
                }
            }
        }
        $("#normal").text(number_array[0][0]);
        $("#temp").text(number_array[0][1]);
        $("#delay").text(number_array[0][2]);
    });
    document.querySelector('#calendar').addEventListener('yearChanged', function(e) {
        //選到目前年份
        var x = thisyear - e.currentYear;
        //只到2019
        if(x <=3 && x >=0){
          $("#normal").text(number_array[x][0]);
          $("#temp").text(number_array[x][1]);
          $("#delay").text(number_array[x][2]);
        }
        else{
          $("#normal").text(0);
          $("#temp").text(0);
          $("#delay").text(0);
        }
        
    })

</script>
</html>