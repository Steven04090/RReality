

    <!DOCTYPE html><html>
      <head>
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-NHCJY83598"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
      
        gtag('config', 'G-NHCJY83598');
      </script>
         <title>R科學-資訊圖表中心(職業DPS)</title>
         <meta name="description" content="R科學，本網站旨在將Ragnarok Online的各種數據以圖像化呈現。">
         <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
         <meta charset="utf-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <link rel="shortcut icon" href="Assets/image/favicon.png" type="image/x-icon">
         <link rel="stylesheet" href="Assets/Content/bootstrap.css">
         <link rel="stylesheet" href="Assets/Content/index.css">
         <link rel="stylesheet" href="Assets/Content/font-awesome.css">
         <script src="Assets/javascript/jquery.min.js"></script>  
         <script src="Assets/javascript/bootstrap.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
         <script src="Assets/javascript/chart.umd.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
         <script src="Assets/javascript/chartjs-plugin-zoom.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
         <script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js"></script>
         <script src="Assets/javascript/jquery.pjax.js"></script>  
      <script> //moment.js轉中文
        moment.locale('zh-tw', {
            months: '一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月'.split('_'),
            monthsShort: '1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月'.split('_'),
            weekdays: '星期日_星期一_星期二_星期三_星期四_星期五_星期六'.split('_'),
            weekdaysShort: '周日_周一_周二_周三_周四_周五_周六'.split('_'),
            weekdaysMin: '日_一_二_三_四_五_六'.split('_'),
            longDateFormat: {
              LT: 'Ah點mm分',
              LTS: 'Ah點m分s秒',
              L: 'YYYY-MM-DD',
              LL: 'YYYY年MMMD日',
              LLL: 'YYYY年MMMD日Ah點mm分',
              LLLL: 'YYYY年MMMD日ddddAh點mm分',
              l: 'YYYY-MM-DD',
              ll: 'YYYY年MMMD日',
              lll: 'YYYY年MMMD日Ah點mm分',
              llll: 'YYYY年MMMD日ddddAh點mm分'
            },
            meridiemParse: /凌晨|早上|上午|中午|下午|晚上/,
            meridiemHour: function (h, meridiem) {
              let hour = h;
              if (hour === 12) {
                hour = 0;
              }
              if (meridiem === '凌晨' || meridiem === '早上' ||
                meridiem === '上午') {
                return hour;
              } else if (meridiem === '下午' || meridiem === '晚上') {
                return hour + 12;
              } else {
                // '中午'
                return hour >= 11 ? hour : hour + 12;
              }
            },
            meridiem: function (hour, minute, isLower) {
              const hm = hour * 100 + minute;
              if (hm < 600) {
                return '凌晨';
              } else if (hm < 900) {
                return '早上';
              } else if (hm < 1130) {
                return '上午';
              } else if (hm < 1230) {
                return '中午';
              } else if (hm < 1800) {
                return '下午';
              } else {
                return '晚上';
              }
            },
            calendar: {
              sameDay: function () {
                return this.minutes() === 0 ? '[今天]Ah[點整]' : '[今天]LT';
              },
              nextDay: function () {
                return this.minutes() === 0 ? '[明天]Ah[點整]' : '[明天]LT';
              },
              lastDay: function () {
                return this.minutes() === 0 ? '[昨天]Ah[點整]' : '[昨天]LT';
              },
              nextWeek: function () {
                let startOfWeek, prefix;
                startOfWeek = moment().startOf('week');
                prefix = this.diff(startOfWeek, 'days') >= 7 ? '[下]' : '[本]';
                return this.minutes() === 0 ? prefix + 'dddA點整' : prefix + 'dddAh點mm';
              },
              lastWeek: function () {
                let startOfWeek, prefix;
                startOfWeek = moment().startOf('week');
                prefix = this.unix() < startOfWeek.unix() ? '[上]' : '[本]';
                return this.minutes() === 0 ? prefix + 'dddAh點整' : prefix + 'dddAh點mm';
              },
              sameElse: 'LL'
            },
            ordinalParse: /\d{1,2}(日|月|周)/,
            ordinal: function (number, period) {
              switch (period) {
                case 'd':
                case 'D':
                case 'DDD':
                  return number + '日';
                case 'M':
                  return number + '月';
                case 'w':
                case 'W':
                  return number + '周';
                default:
                  return number;
              }
            },
            relativeTime: {
              future: '%s内',
              past: '%s前',
              s: '幾秒',
              m: '1 分鐘',
              mm: '%d 分鐘',
              h: '1 小時',
              hh: '%d 小時',
              d: '1 天',
              dd: '%d 天',
              M: '1 個月',
              MM: '%d 个月',
              y: '1 年',
              yy: '%d 年'
            },
            week: {
              // GB/T 7408-1994《数据元和交换格式·信息交换·日期和时间表示法》与ISO 8601:1988等效
              dow: 1, // Monday is the first day of the week.
              doy: 4  // The week that contains Jan 4th is the first week of the year.
            }
          });</script>
      
        <script>
          $(document).ready(function(){
            var winHeight = window.innerHeight;
          window.addEventListener('resize', function(event){
              winHeight = window.innerHeight;
              if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
          // true for mobile device
            $('.content-body').css("height",`calc(${winHeight}px - ${nav_height}px`);
             }
          });
            var nav_height = $('#nav').outerHeight();
          var content_height = $('.content-body').innerHeight();
      
          if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
          // true for mobile device
          $('.content-body').css("height",`calc(${winHeight}px - ${nav_height}px`);
          }else{
            // false for not mobile device
            $('.content-body').css("height",`calc(100vh`);
          }
                   
        });
      </script>
       </head>
       <body>
         <nav id="nav" class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
           <a class="navbar-brand d-lg-none" data-url="index.html" href="#"><img src="Assets/image/logo.png"></a>
           <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
             <span class="navbar-toggler-icon"></span>
           </button>
       
           <div class="collapse navbar-collapse" id="navbarColor01">
             <ul class="navbar-nav mx-auto position-relative">
               <li class="nav-item">
                 <a class="nav-link" href="#">未來UI設計</a>
               </li>
               <li class="nav-item">
                   <a class="nav-link" href="index.html" data-pjax>資訊圖表中心</a>
                 </li>
               <a class="middle-logo d-none d-lg-block"  href="index.html" data-pjax><img src="Assets/image/logo.png"></a>
               <li class="nav-item">
                 <a class="nav-link" href="#">低成本三王</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" href="#">3D Modal</a>
               </li>
             </ul>
           </div>
         </nav>
         <div id="container">
           <div class="index p-1" style="display: none;">
 
           </div>
           <div class="content-body p-1">
<div id="chart-box-layout">
      <div class="infographic_graphic_section p-1">
        <div id="controler" class="controler mb-2">
          <div class="job_menu select_wrap mr-1">
            <ul class="default_option">
                <li>
                    <div>
                      <span>職業: 全部</span>
                    </div>
                </li>
            </ul>
            <ul class="select_ul">
                <li class="job_option" value="all">
                    <div>
                      <span>全部</span>
                    </div>
                </li>
                <li class="job_option" value="盧">
                    <div>
                      <img src="Assets/image/job/Dragon_Knight.bmp">
                      <span>盧恩</span>
                    </div>  
                </li>
                <li class="job_option" value="皇">
                  <div>
                    <img src="Assets/image/job/ImperialGuard.bmp">
                    <span>皇家</span>
                  </div>  
                </li>
                <li class="job_option" value="斬">
                  <div>
                    <img src="Assets/image/job/Shadow_cross.bmp">
                    <span>斬首</span>
                  </div>  
              </li>
              <li class="job_option" value="魅">
                <div>
                  <img src="Assets/image/job/Abyss_Chaser.bmp">
                  <span>魅影</span>
                </div>  
              </li> 
              <li class="job_option" value="咒">
                <div>
                  <img src="Assets/image/job/Arch_Mage.bmp">
                  <span>咒術</span>
                </div>  
              </li>
              <li class="job_option" value="元">
                <div>
                  <img src="Assets/image/job/Elmental_Master.bmp">
                  <span>元素</span>
                </div>  
              </li> 
              <li class="job_option" value="機">
                <div>
                  <img src="Assets/image/job/Meister.bmp">
                  <span>機匠</span>
                </div>  
              </li>
              <li class="job_option" value="基">
                <div>
                  <img src="Assets/image/job/Biolo.bmp">
                  <span>基因</span>
                </div>  
              </li> 
              <li class="job_option" value="主">
                <div>
                  <img src="Assets/image/job/Cardinal.bmp">
                  <span>主教</span>
                </div>  
              </li>
              <li class="job_option" value="修">
                <div>
                  <img src="Assets/image/job/Imquisitor.bmp">
                  <span>修羅</span>
                </div>  
              </li> 
              <li class="job_option" value="遊">
                <div>
                  <img src="Assets/image/job/WindHawk.bmp">
                  <span>遊俠</span>
                </div>  
              </li>
              <li class="job_option" value="詩">
                <div>
                  <img src="Assets/image/job/Troubadour.bmp">
                  <span>詩人</span>
                </div>  
              </li>
              <li class="job_option" value="舞">
                <div>
                  <img src="Assets/image/job/dancing.bmp">
                  <span>舞孃</span>
                </div>  
              </li>
            </ul>
        </div>
         <div class="damage_menu select_wrap mr-1">
          <ul class="default_option">
            <li>
                <div class="on">
                  <span>傷害: 平均單下</span>
                </div>
            </li>
        </ul>
        <ul class="select_ul">
          <li>
              <div class="damage_option">
                <span>平均單下</span>
              </div>
          </li>
        </ul>
         </div>
         <div class="equip_menu select_wrap mr-1">
          <ul class="default_option">
            <li>
                <div class="on">
                  <span>裝備: 全部</span>
                </div>
            </li>
        </ul>
        <ul class="select_ul">
          <li>
              <div class="equip_option">
                <span>全部</span>
              </div>
          </li>
          <li>
            <div class="equip_option">
              <span>無王卡</span>
            </div>
        </li>
        </ul>
         </div>

         <div class="enermy_menu select_wrap mr-1">
          <ul class="default_option">
            <li>
                <div class="on">
                  <span>對象: 中型柱子</span>
                </div>
            </li>
        </ul>
        <ul class="select_ul">
          <li>
              <div class="equip_option">
                <span>中型柱子</span>
              </div>
          </li>
          <li>
        </li>
        </ul>
         </div>
        </div>
        <div class="chart-container">
          <canvas id="canvas_job"></canvas>
          <div class="float_box">
            <div id="data_user" class="p-1" style="display: none;">
              <div id = "data_title" class="px-1"></div>
              <div id = "data_time" class="ml-auto px-1"></div>
              <a onclick="closed_float_box();" class="px-2" style="cursor: pointer;">x</a>
            </div>
            <div id ="equip_table_box" class=" p-1" style="display: none;">
              <div>
                <div class="d-flex">
                <ul class="nav nav-tabs w-100" id="myTab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="front-tab" data-toggle="tab" href="#front" role="tab" aria-controls="front" aria-selected="true">正面裝</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link d-flex margin-auto" id="back-tab" data-toggle="tab" href="#back" role="tab" aria-controls="back" aria-selected="false">背面裝</a>
                  </li>
                </ul>
              </div>
                
                <div class="tab-content" id="myTabContent">
                  <div class="tab-pane fade show active" id="front" role="tabpanel" aria-labelledby="front-tab">
                    <table class="equip-table">
                      <thead>
                        <tbody>
                          <tr><td><div id="e_top"><span></span></div></td><td rowspan="5" id="text-center" style="width:80px;"></td><td><div id="e_top_middle"><span></span></div></td></tr>
                          <tr><td><div id="e_top_down"><span></span></div></td><td><div id="e_cloth"><span></span></div></td></tr>
                          <tr><td><div id="e_weapon"><span></span></div></td><td><div id="e_shield"><span></span></div></td></tr>
                          <tr><td><div id="e_shawl"><span></span></div></td><td><div id="e_shoes"><span></span></div></td></tr>
                          <tr><td><div id="e_accessories_right"><span></span></div></td><td><div id="e_accessories_left"><span></span></div></td></tr>
                        </tbody>
                      </thead>
                    </table>
                  </div>
                  <div class="tab-pane fade" id="back" role="tabpanel" aria-labelledby="back-tab">
                    <table class="equip-table">
                      <thead>
                        <tbody>
                          <tr><td><div id="b_top"><span></span></div></td><td rowspan="5" id="text-center" style="width:80px;"></td><td><div id="b_top_middle"><span></span></div></td></tr>
                          <tr><td><div id="b_top_down"><span></span></div></td><td><div id="b_cloth"><span></span></div></td></tr>
                          <tr><td><div id="b_hand"><span></span></div></td><td><div id="b_shield"><span></span></div></td></tr>
                          <tr><td><div id="b_shawl"><span></span></div></td><td><div id="b_shoes"><span></span></div></td></tr>
                          <tr><td><div id="b_accessories_right"><span></span></div></td><td><div id="b_accessories_left"><span></span></div></td></tr>
                        </tbody>
                      </thead>
                    </table>
                  </div>
                </div>
              </div>
            </div>
        </div>
        </div>
      </div>
    </div>

    <div class="zoom_button_box position-absolute">
      <button class="btn d-flex on-chart-button" onclick="resetZoom()"><i class="fa fa-arrows" style="transform: rotate(45deg);" aria-hidden="true"></i>
      </button>
      <button class="btn d-flex on-chart-button" onclick="Zoomin()"><i class="fa fa-plus" aria-hidden="true"></i>
      </button>
      <button class="btn d-flex on-chart-button" onclick="Zoomout()"><i class="fa fa-minus" aria-hidden="true"></i>
      </button>
    </div>
    </div>
    <script>
  
      //點外面關掉menu
      $(document).on("click", function(event){
        var $trigger = $(".select_wrap");
        if($trigger !== event.target && !$trigger.has(event.target).length){
            $(".select_wrap").removeClass("active");
      }
    })
      //menu開啟
      $(".default_option").click(function(){
        var $this = $(this).parent().find('.select_ul');
        $(".select_wrap .select_ul").not($this).parents(".select_wrap").removeClass("active");
      $(this).parent().toggleClass("active");
    })
    
    //選單覆蓋title
    $(".select_ul li").click(function(){
      var currentele = $(this).html();
      var $this = $(this).closest('.select_wrap');
      $this.find(".default_option li").html(currentele);
      $(this).parents(".select_wrap").removeClass("active");
    })
  
      var chart_job;
      const imageURLs = [ 
      'Assets/image/job/Dragon_Knight.bmp',//盧
      'Assets/image/job/ImperialGuard.bmp',//皇
      'Assets/image/job/Shadow_cross.bmp',//斬
      'Assets/image/job/Abyss_Chaser.bmp',//魅
      'Assets/image/job/Arch_Mage.bmp',//咒
      'Assets/image/job/Elmental_Master.bmp',//元
      'Assets/image/job/Meister.bmp',//機
      'Assets/image/job/Biolo.bmp',//基
      'Assets/image/job/Cardinal.bmp',//主
      'Assets/image/job/Imquisitor.bmp',//修
      'Assets/image/job/WindHawk.bmp',//遊
      'Assets/image/job/Troubadour.bmp',//詩
      'Assets/image/job/dancing.bmp',//舞
      ];
      const images = imageURLs.map(v => {
      var image = new Image();
      image.src = v;
      return image;
      });
      var x_array =[];
      var y_array = [];
      var time_array = [];
      var username = [];
      var job = [];
      var sites = [];
      var temp = [];
      var temp_sites = new Object();
      var temp_sites2 = [];
      var temp_job = [];
      var temp_job2 = [];
      var indexes = [];
      var whole_job_length;
      var data = {datasets: sites};
      var job_value;
      var guess_index = [];
      var onclick_temp = 0;
      var delayed;
  
      const ctx = document.getElementById('canvas_job').getContext('2d');
      //json轉檔
      JsonTransition();
      function JsonTransition(){
      $.getJSON("Assets/json/job_damage.json", function(json_file) {
        
       x_array= json_file.objects.map(function(item ,index) {
          if(item.guess_currency){
            //得知guess的index 存成一個陣列
            guess_index.push(index);
            return Math.floor((item.guess_currency/item.currency_ratio)*10000/39);
          }
          else
        return Math.floor((item.Virtual_currency/item.currency_ratio)*10000/39);
       });
       //json轉成單一array
       y_array = json_file.objects.map(function(item) {
          return item.Every_Damage;
       });
       time_array = json_file.objects.map(function(item) {
          return item.Time;
       });
       username = json_file.objects.map(function(item) {
          return item.username;
       });
       job = json_file.objects.map(function(item) {
          return item.job;
       });
        job_sort();
        // 畫表格
        init();
      });
    };
    
      const zoomOptions = {
          limits:{
            y:{min:0,max:60000,minRange:3000},//minRange控制滾輪放大程度
            x:{min:0,max:12000,minRange:500},
          },
          pan: {
            enabled: true,
            mode: 'xy',
          },
          zoom:{
            wheel: {
              enabled: true,
              //speed:0.05,
            },
            pinch: {
              enabled: true,
            },
            mode: 'xy',
            
            onZoomComplete({chart}) {
            // This update is needed to display up to date zoom level in the title.
            // Without this, previous zoom level is displayed.
            // The reason is: title uses the same beforeUpdate hook, and is evaluated before zoom.
            chart_job.update('none');
            },
          },
          
        }
      const options ={
            maintainAspectRatio:false,
            responsive: true,
            clip: false,
            hover: {
              mode: "nearest",
              axis: "xy",
              intersect: true,
            },
            plugins:{
                zoom: zoomOptions,
                title:{
                  display:false,
                  color:'#fff',
                  position:"bottom",
                  font:{size:20,},
                },
                legend: {
                display: false,
                },
                tooltip: {
                    //events: ['mousemove'],
                    enabled: true,
                    displayColors: false,
                    mode: "nearest",
                    axis: "xy",
                    intersect: true,
                    //鳥爛排版
                    padding:{
                      x:24,
                      y:18,
                    },
                    titleAlign:"center",
                    titleFont:{
                      size: 22,
                      family:'Microsoft JhengHei',
                    },
                    titleColor:'#cacfd4',
                    titleMarginBottom:10,
                    backgroundColor:"#192c40f0",
                    bodyFont: {
                      size: 17,
                      family:'Microsoft JhengHei',
                    },
                    borderColor:'#92f2e9',
                    borderWidth:0.15,
                    callbacks: {
                      title:function(tooltipItems){
                        var title =  tooltipItems[0].dataset.label;
                        return title;
                      },
                        label: function(tooltipItems) {
                          //不=0 代表是我預估的
                          let iamguess =" (玩家提供)";
                          if(tooltipItems.dataset.iamguess !=0){
                            iamguess =" (我預估)";
                          }
                          let label = "花費: " + (tooltipItems.raw.x) + "顆";
                          let label2 = "傷害: " + (tooltipItems.raw.y) + "K";
                          
                          //用空格排版
                          return [label + iamguess, label2];
                        },
                    }
                },
            },
             
            scales: {
                y:{
                    grid: {color: 'rgba( 160, 255, 240, 0.2)',},
                    border:{color:"rgba( 160, 255, 240, 0.25)",width:1,},
                    display:true,
                    max:15000,
                    min:0,
                    ticks: {
                        color:"#f1f1f1",
                        beginAtZero: true,
                        precision:0,
                        padding: 8,
                        crossAlign: 'start',
                        
                        callback: (value, index, ticks) => {
                          if(index === ticks.length - 1){return null;}
                          else
                              if(value >= 10000){return Math.floor(value/1000) + 'M';}
                              else
                                return Math.floor(value) + 'K';
                        }
                    }
                },
                x: {
                  grid: {color: 'rgba( 160, 255, 240, 0.2)',},
                    border:{display:false,},
                    display: true,
                    min:0,
                    max: 800,
                    title:{
                      display: true,
                      text:'(轉蛋價值 39$)',
                      color:'#f1f1f1',
                    },
                    ticks: {
                        color:"#f1f1f1",
                        beginAtZero: true,
                        precision:0,
                        callback: (value, index, ticks) => {
                          if(index === ticks.length - 1){return null;}
                            else
                                return Math.floor(value) + '顆';
                        }
                    }
                },
            },
            animation: {
          onComplete: () => {
            delayed = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayed) {
              delay = context.dataIndex * 10 + context.datasetIndex * 10;
            }
            return delay;
          },
        },
    
            onHover: function (evt, elements) {
                evt.native.target.style.cursor = elements[0] ? 'pointer' : 'grab';
            },
            onClick: (event, elements, chart) => {
              //先還原
              event.chart.data.datasets[onclick_temp].borderColor ='transparent';
              if (elements[0]) {
                //對象的index & Label
                const i = elements[0].datasetIndex;
                onclick_temp = i;
                const datasetLabel = event.chart.data.datasets[i].label;
                event.chart.data.datasets[i].borderColor ="#53F4E7";
                event.chart.data.datasets[i].borderWidth =2;
              }
              chart.update();
            }
        };
    
      const config = {
          type: 'scatter',
          data: data,
          options:options,
          //point click 點data時event
          plugins: [{
  
            id: 'draw_img',
           beforeDraw: chart_job => {
           let datasets = chart_job.data.datasets;
           var counter2 = 0;
           datasets.forEach((e, i) => {
            if (counter2 < whole_job_length) {
             let data = chart_job.getDatasetMeta(i).data;
             var job_selector = job[counter2];
                    switch (job_selector) {
                      case '盧':job_number = 0;break;
                      case '皇':job_number = 1;break;
                      case '斬':job_number = 2;break;
                      case '魅':job_number = 3;break;
                      case '咒':job_number = 4;break;
                      case '元':job_number = 5;break;
                      case '機':job_number = 6;break;
                      case '基':job_number = 7;break;
                      case '主':job_number = 8;break;
                      case '修':job_number = 9;break;
                      case '遊':job_number = 10;break;
                      case '詩':job_number = 11;break;
                      case '舞':job_number = 12;break;
                      default:
                        console.log(`還有其他的?`);
                    }
                    counter2++;
                data.forEach( function(e) {
                  let ctx = chart_job.ctx;
                  let x = e.x;
                  let y = e.y;
                  let r = e.options.radius + 6;
                  //圖片蓋到axis時不顯示
                  if(x < 40 ||ctx.canvas.height - y < 20){
                    return;
                  }
                  else{
                    ctx.save();
                    ctx.beginPath();
                    ctx.drawImage(images[job_number], x-r/2, y-r/2, r, r);
                    ctx.stroke();
                    ctx.restore();
                  }
                  });
            }
          });
            },
                      
            id:'yscaleText',
            afterDraw(chart, args,options){
              const{ ctx, chartArea:{top,bottom,right},scales:{x,y}}= chart_job;
              ctx.save();
              ctx.font ='12px Arial';
              ctx.fillStyle = '#f1f1f1';
              ctx.fillText('(傷害 Damage)',0, top -10);
              ctx.restore();
            },
  
          afterEvent(chart, args, options) {
            if (
                args.event.type === "click" && typeof chart.tooltip.dataPoints !== "undefined"
            ) {
                // note the cursor position upon clicking
                const { x, y } = args.event;
                // note the boundary positions of the nearest chart element
                const left = chart.tooltip.dataPoints[0].element.x - chart.tooltip.dataPoints[0].element.options.radius - 14;
                const right = chart.tooltip.dataPoints[0].element.x + chart.tooltip.dataPoints[0].element.options.radius + 14;
                const top = chart.tooltip.dataPoints[0].element.y - chart.tooltip.dataPoints[0].element.options.radius - 14;
                const bottom = chart.tooltip.dataPoints[0].element.y + chart.tooltip.dataPoints[0].element.options.radius + 14;
                const div = document.getElementById("equip_table_box");
                const div2 = document.getElementById("data_user");
                const title = chart.tooltip.dataPoints[0].dataset.label;
                const time = chart.tooltip.dataPoints[0].dataset.gettime;
    
                // proceed if the cursor is within the element boundaries
                if (x >= left && x <= right && y >= top && y <= bottom) {
                  div.style.display = "block";
                  div2.style.display = "flex";
                  //先找到點到的物件的username
                  //比對equip_data的username
                  //再將內容一個一個map過去
                  $.getJSON("Assets/json/equip_data.json", function(json_file) {
                    for(var i = 0 ;i < json_file.objects.length; i++){
                      if (title == json_file.objects[i].username){
                        $("#data_time").text(time);
    
                        $("#data_title").text(json_file.objects[i].username);
                        $("#e_top").children('span').text(json_file.objects[i].e_top);
                        $("#e_top_middle").children('span').text(json_file.objects[i].e_top_middle);
                        $("#e_top_down").children('span').text(json_file.objects[i].e_top_down);
                        $("#e_cloth").children('span').text(json_file.objects[i].e_cloth);
                        $("#e_weapon").children('span').text(json_file.objects[i].e_weapon);
                        $("#e_shield").children('span').text(json_file.objects[i].e_shield);
                        $("#e_shawl").children('span').text(json_file.objects[i].e_shawl);
                        $("#e_shoes").children('span').text(json_file.objects[i].e_shoes);
                        $("#e_accessories_right").children('span').text(json_file.objects[i].e_accessories_right);
                        $("#e_accessories_left").children('span').text(json_file.objects[i].e_accessories_left);
                        $("#b_top").children('span').text(json_file.objects[i].b_top);
                        $("#b_top_middle").children('span').text(json_file.objects[i].b_top_middle);
                        $("#b_top_down").children('span').text(json_file.objects[i].b_top_down);
                        $("#b_cloth").children('span').text(json_file.objects[i].b_cloth);
                        $("#b_hand").children('span').text(json_file.objects[i].b_hand);
                        $("#b_shield").children('span').text(json_file.objects[i].b_shield);
                        $("#b_shawl").children('span').text(json_file.objects[i].b_shawl);
                        $("#b_shoes").children('span').text(json_file.objects[i].b_shoes);
                        $("#b_accessories_right").children('span').text(json_file.objects[i].b_accessories_right);
                        $("#b_accessories_left").children('span').text(json_file.objects[i].b_accessories_left);
                        break;
                      }
                      else if(i == json_file.objects.length - 1 && title != json_file.objects[i].username){
                        $(".equip-table").find('span').text("沒有 :(");
                        $("#data_user").find('div').text("沒有 :(");
                        $("#data_title").text(title);
                      };
                    };
                  })
                }
                else{
                  div.style.display = "none";
                  div2.style.display = "none";
                }
            }
        }
        }
        ]
          };
      function init() {
        chart_job = new Chart(ctx, config);
        };
  
      //job部分
        function job_sort(){
          whole_job_length = job.length;
          var m = 0;
          for(var i = 0; i < job.length; i++){
            //找到guess位置
            var index = 0;
            if(i == guess_index[m]){
              index = guess_index[m];
              m ++;
            };
                var site = {
                    label:username[i],
                    pointRadius: 24,
                    borderWidth: 0,
                    hitRadius:1,
                    radius:0,
                    hoverBorderWidth:3,
                    hoverRadius:28,
                    borderColor: 'transparent',
                    backgroundColor: 'transparent',
                    hidden:false,
                    pointStyle:'rect',
                    iamguess:index,
                    gettime:time_array[i],
                    data:[{
                    x: Number(x_array[i]),
                    y: Number(y_array[i]),
                    }],
                };
              sites.push(site);
            }
        };
    
        $('.job_option').on('click',  function() {
          //分開js後 寫法變了???
          const val = $(this)[0].attributes.value.value;
        //const val = $(this).attr('value');
        onclick_temp = 0; //切重製
          job_value = val;
          indexes = [];
          //如果目前資料(長度) 不等於 全部資料(長度)，先把暫存移除的資料回復，再做filter，如果已經相等，直接偵測點選的job
          if(whole_job_length != sites.length){
              
            restore_sites();
            detect_job_value();
            chart_job.update();
          }
          else{
            detect_job_value();
          }
      });
    
        function detect_job_value(){ 
          
          if(job_value != 'all'){
              
              for_index();
              chart_job.update();
            }
            else{
              chart_job.update();
            }
        };
    
        function for_index(){
          //重製indexes
          indexes = [];
              for (var index = 0; index < whole_job_length; index++) {
                //job的index也要改
                  if (job[index] != job_value) {
                    indexes.push(index);
                  }
              }
              for (var i = indexes.length -1; i >= 0; i--){
                temp_sites = Object.assign({}, sites.splice(indexes[i],1));
                temp_job = job.splice(indexes[i],1);  
                temp_sites2.push(temp_sites[0]);
                temp_job2.push(temp_job[0]);
              }
        };
    
        function restore_sites(){
          temp_sites = undefined;
          temp_job = undefined;
  
            for (var index = 0; index < temp_sites2.length; index++) {
                    indexes.push(index);
            }
            
            //先取temp_site2的長度出來，寫一個for迴圈，再用Object.assign一個個存入sites
            for (var b = indexes.length -1; b >= 0; b--){
              temp_sites = Object.assign({}, temp_sites2.splice(indexes[b],1));
              temp_job = temp_job2.splice(indexes[b],1);
              sites.push(temp_sites[0]);
              job.push(temp_job[0]);
            }
            temp_job2 = [];
            temp_sites2 = [];
        };
   
  
      function closed_float_box(){
        document.getElementById("equip_table_box").style.display = "none"; 
        document.getElementById("data_user").style.display = "none"; 
      };
    
      //zoom區
      function resetZoom() {
        chart_job.resetZoom();
      };
    
      //模擬滑鼠滾輪 zoom in & out
      function Zoomin() {
        var evt = document.createEvent('MouseEvents');
        evt.initEvent('wheel', true, true);
        evt.deltaY = -2000;
        document.getElementById("canvas").dispatchEvent(evt);
      };
      function Zoomout() {
        var evt = document.createEvent('MouseEvents');
        evt.initEvent('wheel', true, true);
        evt.deltaY = 2000;
        document.getElementById("canvas").dispatchEvent(evt);
      };
      
    
  </script>

    </div>
    </body>
    <script>
      if ($.support.pjax) {
      $(document).on('click', 'a[data-pjax]', function(event) {
        console.log("first");
        var page_path = $(this).attr('href');
            if(page_path == 'index.html'){
              var x = (Number(moment().format('MM')) + Number(moment().format('D'))) * 5;
              var binary = ((x >>> 0).toString(2)).padStart(8,'0');
              $("#password").text(binary);
            }
            else if (page_path == 'server_temporary.html'){
              $.getScript("Assets/javascript/js-year-calendar.min.js");
              $.getScript("Assets/javascript/js-year-calendar.zh-TW.js");
              $.getScript("Assets/javascript/tippy.js");
            }
            else if(page_path == 'Official_Activity.html'){
              $.getScript("Assets/javascript/google_chart.js");
            }
            else{
              return;
            }  
      });
      $(document).on('ready pjax:success', function(event) {
        console.log("later");
          $(document).pjax('[data-pjax] a, a[data-pjax]', '#container',{ fragment: '#container' });
      })
    }
    </script>
</html>