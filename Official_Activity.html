<!DOCTYPE html><html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NHCJY83598"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NHCJY83598');
</script>
   <title>R科學-資訊圖表(官方活動表)</title>
   <meta name="description" content="R科學，本網站旨在將Ragnarok Online的各種數據以圖像化呈現。">
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="shortcut icon" href="Assets/image/favicon.png" type="image/x-icon">
   <link rel="stylesheet" href="Assets/Content/bootstrap.css">
   <link rel="stylesheet" href="Assets/Content/index.css">
   <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" />
   <link rel="stylesheet" href="Assets/Content/jQRangeSlider_classic.css">
  <style>
    #filter_mobile{width:90%;margin:30px auto 0;}
    .ui-rangeSlider-label{cursor: grab;}
    #timeline-filter{height:50px;}
    #timeline-filter svg rect{fill: transparent;}
    #timeline-filter svg g g g g text:nth-child(1){display: none;}
    #timeline-filter svg g g g g text:nth-child(2){fill: #ffffff;}
    #google_chart svg g rect[x="0"]{fill-opacity: 0;}
    /*#google_chart svg text{font-size: 14px;}*/
    .google-visualization-controls-rangefilter-thumblabel{color:#ffffff !important; }
    .google-visualization-controls-label{display: none !important;}
    #google_chart svg g text{fill: #ffffff !important;}
    .ggl-tooltip{min-width: 200px;padding:8px;font-size: 15px;}
  </style>
</head>
<body>
  <nav id="nav" class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="index.html"><img src="Assets/image/logo.png"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarColor01">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">資訊圖表中心</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">未來UI設計</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">低成本三王</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">3D Modal</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="content-body p-1">
    <div id="chart-box-layout">
      <div class="infographic_graphic_section p-1">
        <div class="chart-container">
          <div id="dashboard_div" style="height:100%;">
            <div id="timeline-filter"></div>
            <div id="google_chart" style="height:90%;"></div>
            <div id="filter_mobile"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script
			src="https://code.jquery.com/jquery-1.8.3.min.js"
			integrity="sha256-YcbK69I5IXQftf/mYD8WY0/KmEDCv1asggHpJk1trM8="
			crossorigin="anonymous"></script>
<script
			src="https://code.jquery.com/ui/1.8.0/jquery-ui.min.js"
			integrity="sha256-i1lZLWfq3HA69s3Vuo0Hf5+UhdAftkBVVWFDNfib6Zs="
			crossorigin="anonymous"></script>

<script src="Assets/javascript/jQDateRangeSlider-min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>

  $(document).ready(function () {
    var winHeight = window.innerHeight;

window.addEventListener('resize', function(event){
    winHeight = window.innerHeight;
    if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
    // true for mobile device
      $('.content-body').css("height",`calc(${winHeight}px - ${nav_height}px`);
       }
});
  var nav_height = $('#nav').outerHeight();
  var content_height = $('.content-body').innerHeight();

  if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
  // true for mobile device
  $('.content-body').css("max-height",`calc(${wwinHeight}px - ${nav_height}px`);
  }else{
    // false for not mobile device
    $('.content-body').css("max-height",`calc(100vh - ${nav_height}px`);
  }
        });
 
</script>

<script type="text/javascript">
  google.charts.load('current', {
  callback: function () {
    drawTimeline();
    window.addEventListener('resize', drawTimeline, false);
  },
  packages:['controls','timeline'],'language': 'zh-TW'
});
var timelineRangeSlider;
function drawTimeline() {
    $.ajax({
        url: "Assets/json/official_activity.json",
        dataType: "json",
        success: function (jsonData) {
         var container = document.getElementById('google_chart');
        // var chart = new google.visualization.Timeline(container);
        var dataTable = new google.visualization.DataTable();
            dataTable.addColumn({type: 'string', label:'type'});
            dataTable.addColumn({type: 'string', label:'Name'});
            dataTable.addColumn({type:'date',  label:'Start'});
            dataTable.addColumn({type:'date',  label:'End'});
            for (var i = 0; i < jsonData.rows.length; i++) {
              dataTable.addRow([
                  jsonData.rows[i].c[0],
                  jsonData.rows[i].c[1],
                  new Date(jsonData.rows[i].c[2].v),
                  new Date(jsonData.rows[i].c[3].v),
                ]);
            }

            var formatDate = new google.visualization.DateFormat({
                pattern: 'MM/dd/yyyy'
            });
            dataTable.insertColumn(2, { type: 'string', role: 'tooltip', p: {html: true} });
            for (var i = 0; i < dataTable.getNumberOfRows(); i++) {
                var duration = Math.abs(dataTable.getValue(i, 4).getTime() - dataTable.getValue(i, 3).getTime()) / 1000;
                //沒精準到小時，so直接+1天
                var days = Math.floor(duration / 86400) + 1;
                duration -= days * 86400;

                var tooltip = '';
                tooltip += '<div class="ggl-tooltip"><div>';
                tooltip += '<span>' + dataTable.getValue(i, 1) + '</span>';
                tooltip += '</div><div>';
                tooltip += formatDate.formatValue(dataTable.getValue(i, 3)) + ' - ' + formatDate.formatValue(dataTable.getValue(i, 4));
                tooltip += '</div><div>';
                tooltip += '<span>總時程:&nbsp;</span>'+ days + ' 天 ';
                tooltip += '</div></div>';
                dataTable.setValue(i, 2, tooltip);
            }

             var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));

            var timeline = new google.visualization.ChartWrapper({
            chartType: 'Timeline',
            containerId: 'google_chart',
            view: {columns: [0,1,2,3,4]},
            dataTable:dataTable,
            options:{
              tooltip: {isHtml: true},
              timeline:{
                groupByRowLabel:true,
                colorByRowLabel: true,
                rowLabelStyle: {
                  fontSize: 20,
                },  
                barLabelStyle:{
                  fontSize: 15,
                }
              }
            },
            });
            
            timelineRangeSlider = new google.visualization.ControlWrapper({
              controlType: 'ChartRangeFilter',
              containerId: 'timeline-filter',
              options: {   
                filterColumnIndex: 3,
              //  filterColumnLabel: 'Start',
              ui: {
              chartType: 'ScatterChart',
              chartOptions: {
                chartArea: {width: '95%'},
                hAxis: {baselineColor: 'none'},
                legend: {position: 'none'},
              },
              // Display a single series that shows the closing value of the stock.
              // Thus, this view has two columns: the date (axis) and the stock value (line series).
              chartView: {
                columns: [3, 4]
              },
                // 1 day in milliseconds = 24 * 60 * 60 * 1000 = 86,400,000
                minRangeSize: 86400000
              }
              },
              //日期區間????怪怪der
              state: {range: {start: new Date(2021, 11, 30), end: new Date(2022, 12, 20)}}
            });
            dashboard.bind(timelineRangeSlider, timeline);
            dashboard.draw(dataTable);

            //套件取代google filter
            $('#timeline-filter').hide();
            $('#filter_mobile').show();

            $( "#filter_mobile").dateRangeSlider({
              bounds: {
                min: new Date(2022, 0, 1),
                max: new Date(2022, 11, 31)
              },
              defaultValues: {
                min: new Date(2022, 0, 1),
                max: new Date(2022, 11, 31)
              },
              step: {
                months: 1
              },
              arrows: true,
              wheelMode: null
            }).bind('valuesChanged', function(e, data) {
              timelineRangeSlider.setState({range: { start: data.values.min, end: data.values.max }});
              timelineRangeSlider.draw();
            });


            google.visualization.events.addListener(timeline, 'ready', function () {

                // find <rect> elements
                var rects = container.getElementsByTagName('rect');
                Array.prototype.forEach.call(rects, function(rect) {
                    if (rect.getAttribute('stroke') === '#9a9a9a') {
                    // remove border
                    rect.setAttribute('stroke-width', '0');
                    }
                });

                // find <path> elements 橫線#b7b7b7 直線#e6e6e6
                var paths = container.getElementsByTagName('path');
                Array.prototype.forEach.call(paths, function(path) {
                    if ((path.getAttribute('stroke') === '#ffffff') || (path.getAttribute('stroke') === '#e6e6e6')) {
                    // remove border
                    path.setAttribute('stroke-width', '1');
                    path.setAttribute('stroke', '#ffffff22');
                    }
                    if ((path.getAttribute('stroke') === '#b7b7b7')){
                      path.setAttribute('stroke', '#ffffff22');
                    }
                });

                });

            }
        })
    
}
</script>
<script>
  
</script>
</html>