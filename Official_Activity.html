
    <div id="chart-box-layout">
      <div class="infographic_graphic_section p-1">
        <div class="chart-container">
          <div id="dashboard_div" style="height:100%;">
            <div id="timeline-filter"></div>
            <div id="google_chart" style="height:90%;"></div>
            <div id="filter_mobile"></div>
          </div>
        </div>
      </div>
    </div>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" />
    <link rel="stylesheet" href="Assets/Content/jQRangeSlider_classic.css">
   <style>
     #filter_mobile{width:90%;margin:30px auto 0;}
     .ui-rangeSlider-label{cursor: grab;}
     #timeline-filter{height:50px;}
     #timeline-filter svg rect{fill: transparent;}
     svg text{font-family: 'Microsoft JhengHei','PingFang';}
     #timeline-filter svg g g g g text:nth-child(1){display: none;}
     #timeline-filter svg g g g g text:nth-child(2){fill: #ffffff;}
     #google_chart svg g rect[x="0"]{fill-opacity: 0;}
     /*#google_chart svg text{font-size: 14px;}*/
     .google-visualization-controls-rangefilter-thumblabel{color:#ffffff !important; }
     .google-visualization-controls-label{display: none !important;}
     #google_chart svg g text{fill: #ffffff !important;}
     .ggl-tooltip{min-width: 200px;padding:8px;font-size: 15px;background-color: #c4b8b833;}
   </style>

<script type="text/javascript">
  google.charts.load('current', {
  callback: function () {
    drawTimeline();
    window.addEventListener('resize', drawTimeline, false);
  },
  packages:['controls','timeline'],'language': 'zh-TW'
});
var timelineRangeSlider;
function drawTimeline() {
    $.ajax({
        url: "Assets/json/official_activity.json",
        dataType: "json",
        success: function (jsonData) {
         var container = document.getElementById('google_chart');
        // var chart = new google.visualization.Timeline(container);
        var dataTable = new google.visualization.DataTable();
            dataTable.addColumn({type: 'string', label:'type'});
            dataTable.addColumn({type: 'string', label:'Name'});
            dataTable.addColumn({type:'date',  label:'Start'});
            dataTable.addColumn({type:'date',  label:'End'});
            for (var i = 0; i < jsonData.rows.length; i++) {
              dataTable.addRow([
                  jsonData.rows[i].c[0],
                  jsonData.rows[i].c[1],
                  new Date(jsonData.rows[i].c[2].v),
                  new Date(jsonData.rows[i].c[3].v),
                ]);
            }

            var formatDate = new google.visualization.DateFormat({
                pattern: 'MM/dd/yyyy'
            });
            dataTable.insertColumn(2, { type: 'string', role: 'tooltip', p: {html: true} });
            for (var i = 0; i < dataTable.getNumberOfRows(); i++) {
                var duration = Math.abs(dataTable.getValue(i, 4).getTime() - dataTable.getValue(i, 3).getTime()) / 1000;
                //沒精準到小時，so直接+1天
                var days = Math.floor(duration / 86400) + 1;
                duration -= days * 86400;

                var tooltip = '';
                tooltip += '<div class="ggl-tooltip"><div>';
                tooltip += '<span>' + dataTable.getValue(i, 1) + '</span>';
                tooltip += '</div><div>';
                tooltip += formatDate.formatValue(dataTable.getValue(i, 3)) + ' - ' + formatDate.formatValue(dataTable.getValue(i, 4));
                tooltip += '</div><div>';
                tooltip += '<span>總時程:&nbsp;</span>'+ days + ' 天 ';
                tooltip += '</div></div>';
                dataTable.setValue(i, 2, tooltip);
            }

             var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));

            var timeline = new google.visualization.ChartWrapper({
            chartType: 'Timeline',
            containerId: 'google_chart',
            view: {columns: [0,1,2,3,4]},
            dataTable:dataTable,
            options:{
              colors:['rgb(50, 80, 161)','rgb(116, 49, 110)','rgb(62, 94, 73)','rgb(126, 103, 62)','rgb(57, 121, 141)','rgb(141, 57, 57)'],
              tooltip: {isHtml: true},
              timeline:{
                groupByRowLabel:true,
                
                colorByRowLabel: true,
                rowLabelStyle: {
                  fontSize: 20,
                },  
                barLabelStyle:{
                  fontSize: 15,
                }
              }
            },
            });
            
            timelineRangeSlider = new google.visualization.ControlWrapper({
              controlType: 'ChartRangeFilter',
              containerId: 'timeline-filter',
              options: {   
                filterColumnIndex: 3,
              //  filterColumnLabel: 'Start',
              ui: {
              chartType: 'ScatterChart',
              chartOptions: {
                chartArea: {width: '95%'},
                hAxis: {baselineColor: 'none'},
                legend: {position: 'none'},
              },
              // Display a single series that shows the closing value of the stock.
              // Thus, this view has two columns: the date (axis) and the stock value (line series).
              chartView: {
                columns: [3, 4]
              },
                // 1 day in milliseconds = 24 * 60 * 60 * 1000 = 86,400,000
                minRangeSize: 86400000
              }
              },
              //日期區間????怪怪der
              state: {range: {start: new Date(2021, 11, 30), end: new Date(2022, 12, 20)}}
            });
            dashboard.bind(timelineRangeSlider, timeline);
            dashboard.draw(dataTable);

            //套件取代google filter
            $('#timeline-filter').hide();
            $('#filter_mobile').show();

            $( "#filter_mobile").dateRangeSlider({
              bounds: {
                min: new Date(2022, 0, 1),
                max: new Date(2022, 11, 31)
              },
              defaultValues: {
                min: new Date(2022, 0, 1),
                max: new Date(2022, 11, 31)
              },
              step: {
                months: 1
              },
              arrows: true,
              wheelMode: null
            }).bind('valuesChanged', function(e, data) {
              timelineRangeSlider.setState({range: { start: data.values.min, end: data.values.max }});
              timelineRangeSlider.draw();
            });


            google.visualization.events.addListener(timeline, 'ready', function () {

                // find <rect> elements
                var rects = container.getElementsByTagName('rect');
                Array.prototype.forEach.call(rects, function(rect) {
                    if (rect.getAttribute('stroke') === '#9a9a9a') {
                    // remove border
                    rect.setAttribute('stroke-width', '0');
                    }
                });

                // find <path> elements 橫線#b7b7b7 直線#e6e6e6
                var paths = container.getElementsByTagName('path');
                Array.prototype.forEach.call(paths, function(path) {
                    if ((path.getAttribute('stroke') === '#ffffff') || (path.getAttribute('stroke') === '#e6e6e6')) {
                    // remove border
                    path.setAttribute('stroke-width', '0.5');
                    path.setAttribute('stroke', '#ffffff99');
                    }
                    if ((path.getAttribute('stroke') === '#b7b7b7')){
                      path.setAttribute('stroke', '#ffffff66');
                    }
                });

                });

            }
        })
    
}
</script>
</html>